name: CI/CD Pipeline  
  
on:  
  push:  
    branches:  
      - main  
  
jobs:  
  build-and-push:  
    runs-on: ubuntu-latest  
  
    steps:  
      - name: Checkout repository  
        uses: actions/checkout@v2  
  
      - name: Set up Azure CLI  
        uses: azure/CLI@v1  
  
      - name: Login to Azure Container Registry  
        uses: azure/docker-login@v1  
        with:  
          login-server: IWantToPractice.azurecr.io  
          username: ${{ secrets.ACR_USERNAME }}  
          password: ${{ secrets.ACR_PASSWORD }}  
  
      - name: Build and push Docker image  
        run: |  
          az acr build --registry IWantToPractice --image classificationprac:latest .  
          az acr login --name IWantToPractice  
          docker push IWantToPractice.azurecr.io/classificationprac:latest  
        working-directory: ${{ github.workspace }}  
  
      - name: Deploy to Azure Container Instances  
        uses: azure/aci-deploy@v1  
        with:  
          resource-group: Practice  
          dns-name-label: DockerContainerPrac  
          image: IWantToPractice.azurecr.io/classificationprac:latest  
          registry-login-server: IWantToPractice.azurecr.io  
          registry-username: ${{ secrets.ACR_USERNAME }}  
          registry-password: ${{ secrets.ACR_PASSWORD }}  
          cpu: 1  
          memory: 1  
          port: 5000  
